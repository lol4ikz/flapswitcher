#ifndef F_CPU
#define F_CPU 1000000
#endif

#include <avr/io.h>
#include <avr/interrupt.h>
#include <util/delay.h>

int main() {
    DDRB |= (1<<PB4); // пин на выход

    ADCSRA |= (1<<ADEN); // Enabe ADC 
    ADMUX |= (1<<MUX0); // choose ADC1
    ADCSRA |= (1<<ADPS0) | (1<<ADPS1); // prescaler 8
    ADCSRA |= (1<<ADATE); // Auto trigger enable Free running mode ADTS = 000
    ADCSRA |= (1<<ADSC); // Start convertion
    uint16_t result;
    

    while (1) {
        if (ADCSRA & (1<<ADIF)) { // check flag to zero
            result = ADC;
            if (result >= 500){
                PORTB ^= (1<<PB4); // toggle output
                _delay_ms(300);
            }
        }
        ADCSRA |= (1<<ADIF); // set flag to one
    }
}
